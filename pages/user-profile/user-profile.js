"use strict";(self.webpackChunke_commerce=self.webpackChunke_commerce||[]).push([[204],{5435:(e,t,a)=>{a.d(t,{Z:()=>n});var s=a(7294),r=a(8958),l=a(9849);const o=[{postalCode:/^[0-9]{2}-[0-9]{3}$/,errorMessage:"Почтовый индекс должен иметь формат XX-XXX.",engName:"Poland",ruName:"Польша (PL)",code:"PL"},{postalCode:/^[0-9]{3,3}0$/,errorMessage:"Почтовый индекс должен иметь формат XXX0.",engName:"Belgium",ruName:"Бельгия (BE)",code:"BE"},{postalCode:/^\d{5}$/,errorMessage:"Почтовый индекс должен иметь формат XXXXX.",engName:"Germany",ruName:"Германия (DE)",code:"DE"},{postalCode:/^\d{4}$/,errorMessage:"Почтовый индекс должен иметь формат XXXX.",engName:"Austria",ruName:"Австрия (AT)",code:"AT"},{postalCode:/^\d{5}(?:-\d{4})?$/,errorMessage:"Почтовый индекс должен иметь формат XXXXX, либо XXXXX-XXXX.",engName:"USA",ruName:"США (US)",code:"US"},{postalCode:/^\d{4}$/,errorMessage:"Почтовый индекс должен иметь формат XXXX.",engName:"France",ruName:"Франция (FR)",code:"FR"}],n=({name:e,addressesState:{countryValue:t,cityValue:a,streetValue:n,postalCodeValue:i},setAddressesState:c})=>{const[m,d]=(0,s.useState)(!1),[p,_]=(0,s.useState)({cityErrorValue:"",streetErrorValue:"",postalCodeErrorValue:"",emptyErrorMessage:"",defaultErrorMessage:"Поле обязательно к заполнению",cityErrorMessage:"Поле должно содержать хотя бы один символ и не содержать специальных символов (!@#$%^&*) или цифр.",streetErrorMessage:"Поле должно содержать хотя бы один символ"}),u=e=>{const t=e.target,a=t.textContent;t&&t.textContent&&("keydown"===e.type&&"Enter"===e.key||"click"===e.type)&&(c((e=>({...e,countryValue:a}))),d(!m))};return(0,s.useEffect)((()=>{(()=>{if(!i)return void _((e=>({...e,postalCodeErrorValue:p.defaultErrorMessage})));const e=o.find((({ruName:e})=>e===t));_((t=>({...t,postalCodeErrorValue:e&&e.postalCode.test(i)?"":`${e?.errorMessage}, где Х - цифра`})))})(),a?/^[^\d!@#$%^&*]*$/.test(a)?_((e=>({...e,cityErrorValue:p.emptyErrorMessage}))):/^[^\d!@#$%^&*]*$/.test(a)||_((e=>({...e,cityErrorValue:p.cityErrorMessage}))):_((e=>({...e,cityErrorValue:p.defaultErrorMessage}))),_(n?e=>({...e,streetErrorValue:p.emptyErrorMessage}):e=>({...e,streetErrorValue:p.defaultErrorMessage})),c((e=>({...e,isPostalCodeError:!!p.postalCodeErrorValue,isCityError:!!p.cityErrorValue,isStreetError:!!p.streetErrorValue})))}),[t,a,n,i,p.postalCodeErrorValue,p.cityErrorValue,p.streetErrorValue]),s.createElement("ul",{className:"auth__list auth__list_active"},s.createElement("li",null,s.createElement(l.Z,{sectionName:"auth",listName:"select",title:t,onClickAccordion:()=>{d(!m)},onKeydownAccordion:e=>{"Enter"===e.key&&d(!m)},isOpen:m},o.filter((({ruName:e})=>t!==e)).map((({ruName:e,engName:t})=>s.createElement("li",{className:"auth__select-list-item",value:t,key:t,tabIndex:m?0:-1,onClick:e=>u(e),onKeyDown:e=>u(e)},e))))),s.createElement("li",null,s.createElement(r.Z,{type:"text",placeholder:"Город*",name:`${e}City`,htmlFor:`${e}City`,onChange:e=>{const t=e.target;c((e=>({...e,cityValue:t.value})))},value:a,errors:p.cityErrorValue})),s.createElement("li",null,s.createElement(r.Z,{type:"text",placeholder:"Почтовый индекс*",name:`${e}Index`,htmlFor:`${e}Index`,onChange:e=>{const t=e.target;c((e=>({...e,postalCodeValue:t.value})))},value:i,errors:p.postalCodeErrorValue})),s.createElement("li",null,s.createElement(r.Z,{type:"text",placeholder:"Улица*",name:`${e}Street`,htmlFor:`${e}Street`,onChange:e=>{const t=e.target;c((e=>({...e,streetValue:t.value})))},value:n,errors:p.streetErrorValue})))}},2206:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var s=a(7294),r=a(4309),l=a(4094),o=a(6768),n=a(2823),i=a(3148),c=a(2861),m=a(9091),d=a(5747),p=a(8712);var _=a(6782),u=a(5435);const E=async(e,t)=>{const a={version:e,actions:[{action:"addBillingAddressId",addressId:t}]};return(await c.Z.post(d.Z.URL_API_ME,a,{headers:await(0,m.my)()})).data},f=({addressesState:e,setAddressesState:t,isOpenPopup:a,setIsOpenPopup:r,address:o,initialState:i,isEdit:_})=>{const{userInfo:f,setUserInfo:y}=(0,l.Z)(),[N,h]=(0,s.useState)(!1),g=()=>{r(!1),document.body.classList.remove("body_type_modal")};return s.createElement(s.Fragment,null,s.createElement("div",{className:"popup "+(a?"popup__opened":"")},s.createElement("div",{className:"popup__container"},s.createElement("div",{className:"popup__container-title"},s.createElement("h2",{className:"popup__title"},(_?"Изменить":"Добавить")+" адрес"),s.createElement("button",{className:"popup__close-button",type:"button",onClick:g})),s.createElement("form",{className:"popup__form",onSubmit:_?t=>{h(!0),t.preventDefault();const a=e.countryValue.match(/\((.*?)\)/),s=a?a[1]:"";f&&(async(e,t,a,s,r,l)=>{const o={version:e,actions:[{action:"changeAddress",addressId:t,address:{streetName:a,postalCode:s,city:r,country:l}}]};return(await c.Z.post(d.Z.URL_API_ME,o,{headers:await(0,m.my)()})).data})(f.version,o,e.streetValue,e.postalCodeValue,e.cityValue,s).then((e=>{y(e),g(),h(!1),n.ZP.info({content:"Адрес успешно обновлен!"})})).catch((e=>{h(!1);const{response:{data:{statusCode:t,message:a}}}=e;(0,p.Z)(t,a)}))}:t=>{h(!0),t.preventDefault();let a=!1,s=!1;const r=t.target;new FormData(r).forEach(((e,t)=>{"address"===t&&("shipping"===e?a=!0:"billing"===e&&(s=!0))}));const l=e.countryValue.match(/\((.*?)\)/),o=l?l[1]:"";f&&(async(e,t,a,s,r)=>{const l={version:e,actions:[{action:"addAddress",address:{streetName:t,postalCode:a,city:s,country:r}}]};return(await c.Z.post(d.Z.URL_API_ME,l,{headers:await(0,m.my)()})).data})(f.version,e.streetValue,e.postalCodeValue,e.cityValue,o).then((e=>{y(e),a||s?a?(async(e,t)=>{const a={version:e,actions:[{action:"addShippingAddressId",addressId:t}]};return(await c.Z.post(d.Z.URL_API_ME,a,{headers:await(0,m.my)()})).data})(e.version,e.addresses[e.addresses.length-1].id).then((e=>{y(e),s?E(e.version,e.addresses[e.addresses.length-1].id).then((e=>{y(e),g(),h(!1),n.ZP.info({content:"Адрес успешно добавлен!"}),r.reset()})):(g(),h(!1),n.ZP.info({content:"Адрес успешно добавлен!"}),r.reset())})):E(e.version,e.addresses[e.addresses.length-1].id).then((e=>{y(e),g(),h(!1),n.ZP.info({content:"Адрес успешно добавлен!"}),r.reset()})):(g(),h(!1),n.ZP.info({content:"Адрес успешно добавлен!"}),r.reset())})).catch((e=>{h(!1);const{response:{data:{statusCode:t,message:a}}}=e;(0,p.Z)(t,a)}))},name:_?"edit":"add"},s.createElement(u.Z,{name:_?"edit":"add",addressesState:e,setAddressesState:t}),!_&&s.createElement("div",{className:"profile__container-buttons-edit profile__container-buttons-edit_type_popup"},s.createElement("label",{className:"profile__label profile__label_type_popup"},s.createElement("input",{type:"checkbox",name:"address",value:"shipping",className:"profile__input"}),s.createElement("span",{className:"profile__span profile__span_type_shipping"}),"Добавить в адреса для доставок"),s.createElement("label",{className:"profile__label profile__label_type_popup"},s.createElement("input",{type:"checkbox",name:"address",value:"billing",className:"profile__input"}),s.createElement("span",{className:"profile__span profile__span_type_billing"}),"Добавить в адреса для выставления счетов")),s.createElement("button",{className:"auth__button",type:"submit",disabled:!!(e.isPostalCodeError||e.isCityError||e.isStreetError||N||i?.cityValueInitial===e.cityValue&&i?.countryValueInitial===e.countryValue&&i?.streetValueInitial===e.streetValue&&i?.postalCodeValueInitial===e.postalCodeValue)},_?"Обновить":"Сохранить")))))};var y=a(8948),N=a(8958),h=a(8508);var g=a(6642);const b=[{id:"userData",label:"Личные данные",component:s.createElement((()=>{const{userInfo:e,setUserInfo:t}=(0,l.Z)(),[a,r]=(0,s.useState)(!1),[o,i]=(0,s.useState)(!1),_=()=>{r(!0)};return e?s.createElement(s.Fragment,null,s.createElement("h2",{className:"profile__subtitle"},"Личные данные"),s.createElement(y.J9,{initialValues:{firstName:e.firstName||"",lastName:e.lastName||"",dateOfBirth:e.dateOfBirth||"",email:e.email||""},validationSchema:h.OZ,onSubmit:a=>{i(!0),e&&(async(e,t,a,s,r)=>{const l={version:e,actions:[{action:"changeEmail",email:t},{action:"setFirstName",firstName:a},{action:"setLastName",lastName:s},{action:"setDateOfBirth",dateOfBirth:r}]};return(await c.Z.post(d.Z.URL_API_ME,l,{headers:await(0,m.my)()})).data})(e.version,a.email,a.firstName,a.lastName,a.dateOfBirth).then((e=>{t(e),r(!1),i(!1),n.ZP.info({content:"Данные успешно изменены!"})})).catch((e=>{const{response:{data:{statusCode:t,message:a}}}=e;i(!1),(0,p.Z)(t,a)}))}},(({values:t,errors:l,touched:n,handleChange:i,isValid:c,resetForm:m})=>s.createElement(y.l0,{className:"profile__container-main"},s.createElement("ul",{className:"profile__list"},s.createElement("li",{className:"profile__item"},s.createElement(N.Z,{type:"text",placeholder:"Фамилия*",name:"lastName",htmlFor:"lastName",isInputPassword:!1,onChange:i,value:t.lastName,disabled:!a,errors:l.lastName,touched:n.lastName,isEdit:a})),s.createElement("li",{className:"profile__item"},s.createElement(N.Z,{type:"text",placeholder:"Имя*",name:"firstName",htmlFor:"firstName",isInputPassword:!1,onChange:i,value:t.firstName,disabled:!a,errors:l.firstName,touched:n.firstName,isEdit:a})),s.createElement("li",{className:"profile__item"},s.createElement(N.Z,{type:"date",placeholder:"Дата рождения*",name:"dateOfBirth",htmlFor:"dateOfBirth",isInputPassword:!1,onChange:i,value:t.dateOfBirth,disabled:!a,errors:l.dateOfBirth,touched:n.dateOfBirth,isEdit:a})),s.createElement("li",{className:"profile__item"},s.createElement(N.Z,{type:"text",placeholder:"Email*",name:"email",htmlFor:"email",isInputPassword:!1,onChange:i,value:t.email,disabled:!a,errors:l.email,touched:n.email,isEdit:a}))),a?s.createElement("div",{className:"profile__list"},s.createElement("button",{className:"profile__button",type:"submit",disabled:!c||o||t.lastName===e.lastName&&t.firstName===e.firstName&&t.dateOfBirth===e.dateOfBirth&&t.email===e.email},"Сохранить"),s.createElement("button",{className:"profile__button",type:"button",onClick:()=>{m(),r(!1)}},"Отменить")):s.createElement("button",{className:"profile__button",type:"button",onClick:_},"Редактировать"))))):s.createElement("p",{className:"profile__name"},"Пользователь не авторизован")}),null)},{id:"addresses",label:"Изменить адреса",component:s.createElement((()=>{const{userInfo:e,setUserInfo:t}=(0,l.Z)(),[a,r]=(0,s.useState)(!1),[o,u]=(0,s.useState)(!1),[E,y]=(0,s.useState)(!1),[N,h]=(0,s.useState)(""),[g,b]=(0,s.useState)(!1),[C,v]=(0,s.useState)({countryValue:"Польша (PL)",cityValue:"",isCityError:!0,streetValue:"",isStreetError:!0,postalCodeValue:"",isPostalCodeError:!0}),[w,V]=(0,s.useState)({countryValueInitial:"Польша (PL)",cityValueInitial:"",streetValueInitial:"",postalCodeValueInitial:""}),P={US:"США (US)",FR:"Франция (FR)",PL:"Польша (PL)",BE:"Бельгия (BE)",AT:"Австрия (AT)",DE:"Германия (DE)"},I=()=>{y(!0),document.body.classList.add("body_type_modal")},Z=(a,s)=>{u(!0),e&&("shippingRadio"===a.target.name?(async(e,t)=>{const a={version:e,actions:[{action:"setDefaultShippingAddress",addressId:t}]};return(await c.Z.post(d.Z.URL_API_ME,a,{headers:await(0,m.my)()})).data})(e.version,s).then((e=>{t(e),u(!1),n.ZP.info({content:"Адрес для доставок по умолчанию успешно изменен!"})})).catch((e=>{const{response:{data:{statusCode:t,message:a}}}=e;u(!1),(0,p.Z)(t,a)})):"billingRadio"===a.target.name&&(async(e,t)=>{const a={version:e,actions:[{action:"setDefaultBillingAddress",addressId:t}]};return(await c.Z.post(d.Z.URL_API_ME,a,{headers:await(0,m.my)()})).data})(e.version,s).then((e=>{t(e),u(!1),n.ZP.info({content:"Адрес для выставления счетов по умолчанию успешно изменен!"})})).catch((e=>{const{response:{data:{statusCode:t,message:a}}}=e;u(!1),(0,p.Z)(t,a)})))},S=(e,t,a)=>e.includes(a)?t.includes(a)?"profile__circle_type_general":"profile__circle_type_billing":t.includes(a)?"profile__circle_type_shipping":"";return s.createElement(s.Fragment,null,s.createElement("h2",{className:"profile__subtitle"},"Изменить адреса"),s.createElement("div",{className:"profile__container-addresses"},s.createElement("div",{className:"profile__container-address"},s.createElement("h3",{className:"profile__address-heading "+(a?"":"profile__address-heading_active"),onClick:()=>{r((e=>!e))}},"Адреса"),s.createElement("ul",{className:`profile__addresses ${a?"":"profile__addresses_active"} ${o?"profile__loading":""}`},e&&0!==e.addresses.length?e.addresses.map((a=>s.createElement("li",{className:"profile__address",key:a.id},s.createElement("div",{className:"profile__container-circle-text"},s.createElement("div",{className:`profile__circle ${S(e.billingAddressIds,e.shippingAddressIds,a.id)}`}),s.createElement("p",{className:"profile__address-text"},`${P[a.country]}, г. ${a.city}, ${a.postalCode}, ул. ${a.streetName}`)),s.createElement("div",{className:"profile__container-buttons-edit"},s.createElement("label",{className:"profile__label"},s.createElement("input",{type:"radio",name:"shippingRadio",className:"profile__input",checked:a.id===e.defaultShippingAddressId,onChange:e=>Z(e,a.id)}),s.createElement("span",{className:"profile__span profile__span_type_shipping"})),s.createElement("label",{className:"profile__label"},s.createElement("input",{type:"radio",name:"billingRadio",className:"profile__input",checked:a.id===e.defaultBillingAddressId,onChange:e=>Z(e,a.id)}),s.createElement("span",{className:"profile__span profile__span_type_billing"})),s.createElement("button",{className:"profile__button-edit profile__button-edit_type_edit",type:"button",onClick:()=>{return e=P[a.country],t=a.city,s=a.postalCode,r=a.streetName,l=a.id,v({countryValue:e,cityValue:t,isCityError:!0,streetValue:r,isStreetError:!0,postalCodeValue:s,isPostalCodeError:!0}),V({countryValueInitial:e,cityValueInitial:t,streetValueInitial:r,postalCodeValueInitial:s}),h(l),I(),void b(!0);var e,t,s,r,l}},s.createElement("p",{className:"profile__button-text"},"Редактировать")),s.createElement(i.Z,{title:"Вы уверены, что хотите удалить этот адрес?",onConfirm:()=>{return s=a.id,u(!0),void(e&&(async(e,t)=>{const a={version:e,actions:[{action:"removeAddress",addressId:t}]};return(await c.Z.post(d.Z.URL_API_ME,a,{headers:await(0,m.my)()})).data})(e.version,s).then((e=>{t(e),u(!1),n.ZP.info({content:"Адрес успешно удален!"})})).catch((e=>{const{response:{data:{statusCode:t,message:a}}}=e;u(!1),(0,p.Z)(t,a)})));var s},okText:"Да",cancelText:"Отмена"},s.createElement("button",{className:"profile__button-edit profile__button-edit_type_delete",type:"button"},s.createElement("p",{className:"profile__button-text"},"Удалить"))))))):s.createElement("li",{className:"profile__address-text"},"Адресов нет")),s.createElement("button",{className:"profile__button profile__button_type_edit "+(o?"profile__loading":""),type:"button",onClick:()=>{v({countryValue:"Польша (PL)",cityValue:"",isCityError:!0,streetValue:"",isStreetError:!0,postalCodeValue:"",isPostalCodeError:!0}),V({countryValueInitial:"Польша (PL)",cityValueInitial:"",streetValueInitial:"",postalCodeValueInitial:""}),I(),b(!1)}},"Добавить адрес")),s.createElement("ul",{className:"profile__container-help"},s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__circle profile__circle_type_billing"}),s.createElement("p",{className:"profile__help-text"},"- Адрес находится в списке адресов для выставления счетов")),s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__circle profile__circle_type_shipping"}),s.createElement("p",{className:"profile__help-text"},"- Адрес находится в списке адресов для доставок")),s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__circle profile__circle_type_general"}),s.createElement("p",{className:"profile__help-text"},"- Адрес находится в списке адресов для доставок и выставления счетов")),s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__cell profile__cell_type_billing"}),s.createElement("p",{className:"profile__help-text"},"- Ячейка выбора адреса для выставления счетов по умолчанию")),s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__cell profile__cell_type_shipping"}),s.createElement("p",{className:"profile__help-text"},"- Ячейка выбора адреса для доставок по умолчанию")),s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__default profile__default_type_billing"}),s.createElement("p",{className:"profile__help-text"},"- Адрес выбран для выставления счетов по умолчанию")),s.createElement("li",{className:"profile__help"},s.createElement("div",{className:"profile__default profile__default_type_shipping"}),s.createElement("p",{className:"profile__help-text"},"- Адрес выбран для доставок по умолчанию")))),s.createElement(_.Z,{pageClassname:"user-profile",isDataFetching:o}),s.createElement(f,{addressesState:C,setAddressesState:v,isOpenPopup:E,setIsOpenPopup:y,address:N,initialState:w,isEdit:g}))}),null)},{id:"password",label:"Изменить пароль",component:s.createElement((()=>{const{userInfo:e,setUserInfo:t}=(0,l.Z)(),[a,r]=(0,s.useState)(!1);return s.createElement(s.Fragment,null,s.createElement("h2",{className:"profile__subtitle"},"Изменить пароль"),s.createElement(y.J9,{initialValues:{password:"",newPassword:"",newPasswordConfirm:""},validationSchema:h.pk,onSubmit:(a,{resetForm:s})=>{r(!0),e&&(async(e,t,a)=>{const s={version:e,currentPassword:t,newPassword:a};return(await c.Z.post(d.Z.URL_API_ME_PASSWORD,s,{headers:await(0,m.my)()})).data})(e.version,a.password,a.newPassword).then((l=>{t(l),r(!1),n.ZP.info({content:"Пароль успешно изменен!"}),s(),(0,g.k0)(e.email,a.newPassword).then((e=>{null!==e&&"object"==typeof e&&(0,g.F_)(e,"1SortUserToken")}))})).catch((e=>{const{response:{data:{statusCode:t,message:a}}}=e;r(!1),(0,p.Z)(t,a)}))}},(({values:e,errors:t,touched:r,handleChange:l,isValid:o,dirty:n})=>s.createElement(y.l0,{className:"profile__container-main"},s.createElement("ul",{className:"profile__list"},s.createElement("li",{className:"profile__item profile__type_password"},s.createElement(N.Z,{type:"password",placeholder:"Старый пароль*",name:"password",htmlFor:"password",isInputPassword:!0,onChange:l,value:e.password,errors:t.password,touched:r.password})),s.createElement("li",{className:"profile__item profile__type_password"},s.createElement(N.Z,{type:"password",placeholder:"Новый пароль*",name:"newPassword",htmlFor:"newPassword",isInputPassword:!0,onChange:l,value:e.newPassword,errors:t.newPassword,touched:r.newPassword})),s.createElement("li",{className:"profile__item profile__type_password"},s.createElement(N.Z,{type:"password",placeholder:"Подтвердите новый пароль*",name:"newPasswordConfirm",htmlFor:"newPasswordConfirm",isInputPassword:!0,onChange:l,value:e.newPasswordConfirm,errors:t.newPasswordConfirm,touched:r.newPasswordConfirm}))),s.createElement("div",{className:"profile__list"},s.createElement("button",{className:"profile__button",type:"submit",disabled:!o||!n||a||e.password===e.newPassword},"Сохранить"))))))}),null)}],C=()=>{if("loading"===(0,r.HJ)().state)return s.createElement(o.Z,{pageClassname:"catalog"});const{userInfo:e,isContentLoadedPageUserInfo:t}=(0,l.Z)(),[a,n]=(0,s.useState)("userData");return t?s.createElement(o.Z,{pageClassname:"user-profile"}):s.createElement("section",{className:"profile","aria-label":"Профиль"},s.createElement("div",{className:"profile__container"},s.createElement("div",{className:"profile__info"},s.createElement("div",{className:"profile__container-info"},e?s.createElement(s.Fragment,null,s.createElement("p",{className:"profile__name"},`${e.firstName} ${e.lastName}`),s.createElement("p",{className:"profile__email"},e.email)):s.createElement("p",{className:"profile__name"},"Пользователь не авторизован")),s.createElement("ul",{className:"profile__categories"},s.createElement("li",{className:"profile__category"},s.createElement("div",{className:"profile__container-icon-name"},s.createElement("div",{className:"profile__category-icon profile__category-icon_type_home"}),s.createElement("p",{className:"profile__category-name"},"Мой кабинет"))),s.createElement("li",{className:"profile__category"},s.createElement("div",{className:"profile__container-icon-name"},s.createElement("div",{className:"profile__category-icon profile__category-icon_type_user"}),s.createElement("p",{className:"profile__category-name"},"Профиль")),s.createElement("ul",{className:"profile__subcategories"},b.map((e=>s.createElement("li",{key:e.id},s.createElement("button",{className:"profile__subcategory "+(a===e.id?"profile__subcategory_active":""),type:"button",onClick:()=>{return t=e.id,void n(t);var t}},e.label)))))))),b.map((e=>s.createElement("div",{className:"profile__main",key:e.id},a===e.id&&e.component)))))}}}]);